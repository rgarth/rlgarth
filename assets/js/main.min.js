console.log('%crlgarth.com', 'font-weight: bold; font-size: 14px; color: #2a4a3e;');
console.log('Version: 082cd8f');
console.log('Built: 2026-02-09 10:56');
const CONFIG = {

sections: [
{ start: 0, end: 0.18, id: 'section0' }, 
{ start: 0.18, end: 0.36, id: 'section1' }, 
{ start: 0.36, end: 0.56, id: 'section2' }, 
{ start: 0.56, end: 0.78, id: 'section3' }, 
{ start: 0.78, end: 1, id: 'section4' } 
],


dark: {
start: 0.30,
peak: 0.46,
end: 0.56
},


paper: {
start: 0.56,
peak: 0.67,
end: 0.78
},


fairyZone: { start: 0.12, end: 0.30 },
wraithZone: { start: 0.36, end: 0.54 },


foliage: {
mobile: { bgLeaves: 5, midLeaves: 8, fgLeaves: 4, flowers: 3, trunks: 4, webs: 3, bones: 2, papers: 2, pencils: 2, boxes: 2, cabinets: 1 },
desktop: { bgLeaves: 12, midLeaves: 16, fgLeaves: 10, flowers: 5, trunks: 8, webs: 5, bones: 3, papers: 3, pencils: 3, boxes: 3, cabinets: 2 }
},


spreadMultiplier: { mobile: 60, desktop: 120 },
zoomMultiplier: { mobile: 0.6, desktop: 1.2 },
darkSpread: { mobile: 15, desktop: 30 },
paperSpread: { mobile: 15, desktop: 30 },
scaleMultiplier: { mobile: 0.1, desktop: 0.2 }
};
const SKY_STOPS = [
{ pos: 0, color: '#f8f4ef' }, 
{ pos: 0.18, color: '#e0ebe0' }, 
{ pos: 0.32, color: '#6a7080' }, 
{ pos: 0.46, color: '#1a1a28' }, 
{ pos: 0.56, color: '#3a3530' }, 
{ pos: 0.67, color: '#c8b898' }, 
{ pos: 0.78, color: '#e8dcc8' }, 
{ pos: 1, color: '#f8f4ef' } 
];
if ('scrollRestoration' in history) {
history.scrollRestoration = 'manual';
}
if (!window.location.hash) {
window.scrollTo(0, 0);
}
const isMobile = window.innerWidth <= 600;
const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
const viewport = document.getElementById('viewport');
const sky = document.getElementById('sky');
const progress = document.getElementById('progress');
const scrollHint = document.getElementById('scrollHint');
const entryScreen = document.getElementById('entryScreen');
const navBar = document.getElementById('navBar');
const yearEl = document.getElementById('year');
if (yearEl) yearEl.textContent = new Date().getFullYear();
const entryText = document.querySelector('.entry-text');
const scrollHintText = document.querySelector('.scroll-hint span');
if (isTouchDevice) {
if (entryText) entryText.textContent = 'Swipe to enter';
if (scrollHintText) scrollHintText.textContent = 'Swipe';
}
const hashToSection = {
'home': 0,
'penelope': 1,
'boneeaters': 2,
'stories': 3,
'about': 4
};
function navigateToSection(sectionIndex) {
const section = CONFIG.sections[sectionIndex];
if (!section) return;
const targetPercent = (section.start + section.end) / 2;
const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
window.scrollTo({ top: targetPercent * maxScroll, behavior: 'smooth' });
}
document.querySelectorAll('.nav-link').forEach(link => {
link.addEventListener('click', (e) => {
e.preventDefault();
const sectionIndex = parseInt(e.target.dataset.section);
const hash = e.target.getAttribute('href'); 
if (isTouchDevice) {
currentSection = sectionIndex;
}
navigateToSection(sectionIndex);

if (hash) {
history.pushState(null, null, hash);
}
});
});
function handleHash() {
const hash = window.location.hash.slice(1); 
if (hash && hashToSection.hasOwnProperty(hash)) {
const sectionIndex = hashToSection[hash];
if (isTouchDevice) {
currentSection = sectionIndex;
}

setTimeout(() => navigateToSection(sectionIndex), 100);
}
}
window.addEventListener('hashchange', handleHash);
if (window.location.hash) {
handleHash();
}
const foliageElements = [];
const counts = isMobile ? CONFIG.foliage.mobile : CONFIG.foliage.desktop;
function createFoliageItem(src, opts) {
const el = document.createElement('div');
el.className = 'foliage-item';

const size = opts.sizeRange[0] + Math.random() * (opts.sizeRange[1] - opts.sizeRange[0]);
let x, y, rotation = Math.random() * 360;

if (opts.coverage === 'full') {
x = -10 + Math.random() * 120;
y = -10 + Math.random() * 120;
} else if (opts.coverage === 'edges') {
const edge = Math.random();
if (edge < 0.3) { x = -5 + Math.random() * 30; y = Math.random() * 100; }
else if (edge < 0.6) { x = 70 + Math.random() * 35; y = Math.random() * 100; }
else if (edge < 0.8) { x = Math.random() * 100; y = -5 + Math.random() * 30; }
else { x = Math.random() * 100; y = 70 + Math.random() * 35; }
} else if (opts.coverage === 'vertical') {
x = -10 + Math.random() * 120;
y = 20 + Math.random() * 80;
rotation = -10 + Math.random() * 20;
} else if (opts.coverage === 'corners') {
const corner = Math.floor(Math.random() * 4);
if (corner === 0) { x = -5 + Math.random() * 25; y = -5 + Math.random() * 25; }
else if (corner === 1) { x = 75 + Math.random() * 30; y = -5 + Math.random() * 25; }
else if (corner === 2) { x = -5 + Math.random() * 25; y = 75 + Math.random() * 30; }
else { x = 75 + Math.random() * 30; y = 75 + Math.random() * 30; }
rotation = Math.random() * 360;
} else {
x = 5 + Math.random() * 90;
y = 5 + Math.random() * 90;
}

el.style.cssText = `
width: ${size}px;
height: ${opts.coverage === 'vertical' ? size * 2.5 : size}px;
left: ${x}%; top: ${y}%;
z-index: ${Math.floor(opts.z * 10)};
opacity: ${opts.opacity};
filter: blur(${opts.blur || 0}px);
ransform: rotate(${rotation}deg);
`;

const img = document.createElement('img');
img.src = src;
el.appendChild(img);

foliageElements.push({
el, baseX: x, baseY: y, z: opts.z, rotation, size,
baseOpacity: opts.opacity, isFlower: src.includes('flower'), 
isDark: opts.isDark || false, isPaper: opts.isPaper || false
});

viewport.insertBefore(el, viewport.firstChild);
}
for (let i = 0; i < counts.bgLeaves; i++) createFoliageItem('assets/img/leaves.svg', { sizeRange: [80, 150], z: 0.5 + Math.random() * 0.5, opacity: 0.3 + Math.random() * 0.15, blur: 0, coverage: 'full', isDark: false, isPaper: false });
for (let i = 0; i < counts.midLeaves; i++) createFoliageItem('assets/img/leaves.svg', { sizeRange: [120, 220], z: 1 + Math.random() * 1, opacity: 0.6 + Math.random() * 0.2, blur: 0, coverage: 'full', isDark: false, isPaper: false });
for (let i = 0; i < counts.fgLeaves; i++) createFoliageItem('assets/img/leaves.svg', { sizeRange: [180, 320], z: 2 + Math.random() * 1.5, opacity: 0.8 + Math.random() * 0.2, blur: 0, coverage: 'edges', isDark: false, isPaper: false });
for (let i = 0; i < counts.flowers; i++) createFoliageItem('assets/img/flower-pink.svg', { sizeRange: [35, 60], z: 2.5 + Math.random() * 1, opacity: 0.9, blur: 0, coverage: 'scattered', isDark: false, isPaper: false });
for (let i = 0; i < Math.floor(counts.flowers * 0.8); i++) createFoliageItem('assets/img/flower-yellow.svg', { sizeRange: [30, 50], z: 2.5 + Math.random() * 1, opacity: 0.9, blur: 0, coverage: 'scattered', isDark: false, isPaper: false });
for (let i = 0; i < Math.floor(counts.flowers * 0.8); i++) createFoliageItem('assets/img/flower-blue.svg', { sizeRange: [32, 55], z: 2.5 + Math.random() * 1, opacity: 0.9, blur: 0, coverage: 'scattered', isDark: false, isPaper: false });
for (let i = 0; i < counts.trunks; i++) createFoliageItem('assets/img/dark-trunk.svg', { sizeRange: [200, 450], z: 0.5 + Math.random() * 2.5, opacity: 0, blur: 0, coverage: 'vertical', isDark: true, isPaper: false });
for (let i = 0; i < counts.webs; i++) createFoliageItem('assets/img/spider-web.svg', { sizeRange: [100, 200], z: 1 + Math.random() * 2, opacity: 0, blur: 0, coverage: 'corners', isDark: true, isPaper: false });
for (let i = 0; i < counts.bones; i++) createFoliageItem('assets/img/bone.svg', { sizeRange: [60, 120], z: 1.5 + Math.random() * 1.5, opacity: 0, blur: 0, coverage: 'scattered', isDark: true, isPaper: false });
for (let i = 0; i < counts.papers; i++) createFoliageItem('assets/img/paper.svg', { sizeRange: [60, 100], z: 1 + Math.random() * 1.5, opacity: 0, blur: 0, coverage: 'edges', isDark: false, isPaper: true });
for (let i = 0; i < counts.pencils; i++) createFoliageItem('assets/img/pencil.svg', { sizeRange: [120, 180], z: 1 + Math.random() * 1.5, opacity: 0, blur: 0, coverage: 'full', isDark: false, isPaper: true });
for (let i = 0; i < counts.boxes; i++) createFoliageItem('assets/img/boxes.svg', { sizeRange: [80, 140], z: 1 + Math.random() * 1.5, opacity: 0, blur: 0, coverage: 'full', isDark: false, isPaper: true });
for (let i = 0; i < counts.cabinets; i++) createFoliageItem('assets/img/file-cabinet.svg', { sizeRange: [120, 180], z: 0.8 + Math.random() * 1, opacity: 0, blur: 0, coverage: 'edges', isDark: false, isPaper: true });
function hexToRgb(hex) {
return { r: parseInt(hex.slice(1,3), 16), g: parseInt(hex.slice(3,5), 16), b: parseInt(hex.slice(5,7), 16) };
}
function interpolateColor(stops, pos) {
let lower = stops[0], upper = stops[stops.length-1];
for (let i = 0; i < stops.length - 1; i++) {
if (pos >= stops[i].pos && pos <= stops[i+1].pos) { lower = stops[i]; upper = stops[i+1]; break; }
}
const t = upper.pos === lower.pos ? 0 : (pos - lower.pos) / (upper.pos - lower.pos);
const c1 = hexToRgb(lower.color), c2 = hexToRgb(upper.color);
return `rgb(${Math.round(c1.r + (c2.r - c1.r) * t)},${Math.round(c1.g + (c2.g - c1.g) * t)},${Math.round(c1.b + (c2.b - c1.b) * t)})`;
}
function getScrollPercent() {
const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
return Math.min(1, Math.max(0, window.scrollY / maxScroll));
}
function isInZone(scrollPercent, zone) {
return scrollPercent >= zone.start && scrollPercent <= zone.end;
}
function update() {
const scrollPercent = getScrollPercent();
const { dark, paper } = CONFIG;
const spreadMult = isMobile ? CONFIG.spreadMultiplier.mobile : CONFIG.spreadMultiplier.desktop;
progress.style.width = (scrollPercent * 100) + '%';
entryScreen.classList.toggle('hidden', scrollPercent > 0.01);
navBar.classList.toggle('dark', scrollPercent > 0.32 && scrollPercent < 0.56);
navBar.classList.toggle('sepia', scrollPercent >= 0.56 && scrollPercent < 0.78);
scrollHint.classList.toggle('visible', scrollPercent > 0.12 && scrollPercent < 0.90);


const currentColor = interpolateColor(SKY_STOPS, scrollPercent);
sky.style.background = currentColor;
document.body.style.backgroundColor = currentColor;
const spread = scrollPercent * spreadMult;
const inDarkZone = scrollPercent > dark.start && scrollPercent < dark.end;
const inPaperZone = scrollPercent > paper.start && scrollPercent < paper.end;


let darkIntensity = 0;
if (scrollPercent >= dark.start && scrollPercent <= dark.peak) {
darkIntensity = (scrollPercent - dark.start) / (dark.peak - dark.start);
} else if (scrollPercent > dark.peak && scrollPercent <= dark.end) {
darkIntensity = 1 - (scrollPercent - dark.peak) / (dark.end - dark.peak);
}


let paperIntensity = 0;
if (scrollPercent >= paper.start && scrollPercent <= paper.peak) {
paperIntensity = (scrollPercent - paper.start) / (paper.peak - paper.start);
} else if (scrollPercent > paper.peak && scrollPercent <= paper.end) {
paperIntensity = 1 - (scrollPercent - paper.peak) / (paper.end - paper.peak);
}
const zoomMult = isMobile ? CONFIG.zoomMultiplier.mobile : CONFIG.zoomMultiplier.desktop;
const darkSpread = isMobile ? CONFIG.darkSpread.mobile : CONFIG.darkSpread.desktop;
const paperSpread = isMobile ? CONFIG.paperSpread.mobile : CONFIG.paperSpread.desktop;
const scaleMult = isMobile ? CONFIG.scaleMultiplier.mobile : CONFIG.scaleMultiplier.desktop;
foliageElements.forEach(item => {
const xFromCenter = item.baseX - 50, yFromCenter = item.baseY - 50;
const distFromCenter = Math.sqrt(xFromCenter * xFromCenter + yFromCenter * yFromCenter);
const spreadMultiplier = 0.5 + distFromCenter / 70;
let moveX, moveY, scale;

if (item.isDark) {

scale = 0.3 + darkIntensity * item.z * zoomMult;
moveX = xFromCenter * darkIntensity * darkSpread * item.z / 50;
moveY = yFromCenter * darkIntensity * darkSpread * item.z / 50;
item.el.style.opacity = darkIntensity * 0.85;
} else if (item.isPaper) {

scale = 0.4 + paperIntensity * item.z * zoomMult * 0.7;
moveX = xFromCenter * paperIntensity * paperSpread * item.z / 50;
moveY = yFromCenter * paperIntensity * paperSpread * item.z / 50;
item.el.style.opacity = paperIntensity * 0.6;
} else {

moveX = xFromCenter * spread * item.z * spreadMultiplier / 50;
moveY = yFromCenter * spread * item.z * spreadMultiplier / 50;
scale = 1 + scrollPercent * item.z * scaleMult;

if (inDarkZone) {
item.el.style.opacity = item.isFlower ? 0.05 : (1 - darkIntensity) * 0.4;
} else if (inPaperZone) {
item.el.style.opacity = item.isFlower ? 0.1 : (1 - paperIntensity) * 0.5;
} else {
item.el.style.opacity = item.baseOpacity || '';
}
}

item.el.style.transform = `translate(${moveX}px, ${moveY}px) scale(${scale}) rotate(${item.rotation}deg)`;
});
CONFIG.sections.forEach((sec, index) => {
const el = document.getElementById(sec.id);
const center = (sec.start + sec.end) / 2;
const range = (sec.end - sec.start) / 2 * 0.85;
let isActive = Math.abs(scrollPercent - center) < range;
if (index === CONFIG.sections.length - 1 && scrollPercent > 0.90) isActive = true;
el.classList.toggle('active', isActive);
});
}
const fairyImages = ['assets/img/fairy-pink.png', 'assets/img/fairy-yellow.png'];
let fairyActive = false, fairyTimeout = null;
function spawnFairy() {
const scrollPercent = getScrollPercent();
if (fairyActive || !isInZone(scrollPercent, CONFIG.fairyZone)) {
if (isInZone(scrollPercent, CONFIG.fairyZone)) scheduleNextFairy();
return;
}
fairyActive = true;

const fairy = document.createElement('img');
fairy.src = fairyImages[Math.floor(Math.random() * fairyImages.length)];
const goingLeft = Math.random() > 0.5;
const startY = 5 + Math.random() * 90;
const size = 30 + Math.random() * 20;
const duration = 7 + Math.random() * 4;

fairy.style.width = size + 'px';
fairy.style.setProperty('--duration', duration + 's');
fairy.style.top = startY + 'vh';
fairy.style.zIndex = Math.floor(1 + Math.random() * 25);
fairy.className = goingLeft ? 'fairy right-to-left' : 'fairy left-to-right';

viewport.appendChild(fairy);
setTimeout(() => { fairy.remove(); fairyActive = false; scheduleNextFairy(); }, (duration + 0.5) * 1000);
}
function scheduleNextFairy() {
if (fairyTimeout) clearTimeout(fairyTimeout);
if (!isInZone(getScrollPercent(), CONFIG.fairyZone)) return;
fairyTimeout = setTimeout(spawnFairy, 2000 + Math.random() * 6000);
}
function stopFairies() {
if (fairyTimeout) { clearTimeout(fairyTimeout); fairyTimeout = null; }
document.querySelectorAll('.fairy').forEach(f => {
f.style.transition = 'opacity 0.4s ease-out';
f.style.opacity = '0';
setTimeout(() => f.remove(), 400);
});
fairyActive = false;
}
const darkFairyImages = ['assets/img/dark-fairy.png', 'assets/img/dark-fairy-2.png'];
let wraithActive = false, wraithTimeout = null;
function spawnWraith() {
const scrollPercent = getScrollPercent();
if (wraithActive || !isInZone(scrollPercent, CONFIG.wraithZone)) {
if (isInZone(scrollPercent, CONFIG.wraithZone)) scheduleNextWraith();
return;
}
wraithActive = true;

const wraith = document.createElement('img');
wraith.src = darkFairyImages[Math.floor(Math.random() * darkFairyImages.length)];
const goingLeft = Math.random() > 0.5;
const angle = (Math.random() - 0.5) * 60;
const verticalOffset = Math.tan(angle * Math.PI / 180) * 100;
const startY = 20 + Math.random() * 50;
const endY = Math.max(5, Math.min(85, startY + verticalOffset));
const size = 30 + Math.random() * 20;
const duration = 7.5 + Math.random() * 4.5;

wraith.style.width = size + 'px';
wraith.style.setProperty('--duration', duration + 's');
wraith.style.setProperty('--start-y', startY + 'vh');
wraith.style.setProperty('--end-y', endY + 'vh');
wraith.style.setProperty('--scale', 0.8 + Math.random() * 0.5);
wraith.style.zIndex = Math.floor(5 + Math.random() * 25);
wraith.className = `wraith ${goingLeft ? 'right-to-left' : 'left-to-right'}`;

viewport.appendChild(wraith);
setTimeout(() => { wraith.remove(); wraithActive = false; scheduleNextWraith(); }, (duration + 0.5) * 1000);
}
function scheduleNextWraith() {
if (wraithTimeout) clearTimeout(wraithTimeout);
if (!isInZone(getScrollPercent(), CONFIG.wraithZone)) return;
wraithTimeout = setTimeout(spawnWraith, 3000 + Math.random() * 7000);
}
function stopWraiths() {
if (wraithTimeout) { clearTimeout(wraithTimeout); wraithTimeout = null; }
document.querySelectorAll('.wraith').forEach(w => w.remove());
wraithActive = false;
}
function openExcerpt(excerptName) {
const modal = document.getElementById('excerptModal');
const content = document.getElementById('excerptContent');

fetch(`/assets/content/excerpt-${excerptName}.html`)
.then(r => {
if (!r.ok) throw new Error('Excerpt not found');
return r.text();
})
.then(html => {
content.innerHTML = html;

if (excerptName.includes('bone-eaters')) {
content.style.background = '#0d0d14';
} else if (excerptName.includes('remys-boxes')) {
content.style.background = '#f5f0e6';
} else {
content.style.background = '#fefdfb';
}
modal.classList.add('open');
document.body.style.overflow = 'hidden';

requestAnimationFrame(() => {
content.scrollTop = 0;
});
})
.catch(err => {
console.error('Failed to load excerpt:', err);
content.innerHTML = '<div class="excerpt-body"><p>Sorry, this excerpt could not be loaded.</p></div>';
modal.classList.add('open');
document.body.style.overflow = 'hidden';
});
}
function closeExcerpt() {
document.getElementById('excerptModal').classList.remove('open');
document.body.style.overflow = '';
}
window.openExcerpt = openExcerpt;
window.closeExcerpt = closeExcerpt;
let ticking = false;
let wasInFairyZone = false;
let wasInWraithZone = false;
window.addEventListener('scroll', () => {
if (!ticking && !isNavigating) {
requestAnimationFrame(() => {
update();


const scrollPercent = getScrollPercent();
const inFairyZone = isInZone(scrollPercent, CONFIG.fairyZone);
const inWraithZone = isInZone(scrollPercent, CONFIG.wraithZone);

if (inFairyZone && !wasInFairyZone) {
fairyTimeout = setTimeout(spawnFairy, 1000);
} else if (!inFairyZone && wasInFairyZone) {
stopFairies();
}

if (inWraithZone && !wasInWraithZone) {
wraithTimeout = setTimeout(spawnWraith, 1500);
} else if (!inWraithZone && wasInWraithZone) {
stopWraiths();
}

wasInFairyZone = inFairyZone;
wasInWraithZone = inWraithZone;

icking = false;
});
icking = true;
}
});
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeExcerpt(); });
let isNavigating = false;
let currentSection = 0; 
if (isTouchDevice) {
let touchStartY = 0;
let touchStartTime = 0;
let touchStartSection = 0;


document.body.style.overflow = 'hidden';
document.documentElement.style.overflow = 'hidden';

document.addEventListener('touchstart', (e) => {

if (e.target.closest('.excerpt-modal')) return; 

ouchStartY = e.touches[0].clientY;
ouchStartTime = Date.now();
ouchStartSection = currentSection;
}, { passive: false });

document.addEventListener('touchmove', (e) => {

if (e.target.closest('.excerpt-modal')) return;
e.preventDefault();
}, { passive: false });

document.addEventListener('touchend', (e) => {

if (e.target.closest('.excerpt-modal')) return;

if (isNavigating) return;

const touchEndY = e.changedTouches[0].clientY;
const touchEndTime = Date.now();
const deltaY = touchStartY - touchEndY;
const deltaTime = touchEndTime - touchStartTime;
const velocity = Math.abs(deltaY) / deltaTime;


const threshold = 30;
const isSwipe = Math.abs(deltaY) > threshold || velocity > 0.3;

if (isSwipe) {
let targetSection = null;



if (deltaY > 0 && touchStartSection < CONFIG.sections.length - 1) {
argetSection = touchStartSection + 1;
} else if (deltaY < 0 && touchStartSection > 0) {
argetSection = touchStartSection - 1;
}

if (targetSection !== null) {
isNavigating = true;
currentSection = targetSection;


const hashNames = ['home', 'penelope', 'boneeaters', 'stories', 'about'];
if (hashNames[targetSection]) {
history.pushState(null, null, '#' + hashNames[targetSection]);
}

navigateToSection(targetSection);
setTimeout(() => { isNavigating = false; }, 1000);
}
}
}, { passive: false });


if (window.location.hash) {
handleHash();
} else {

navigateToSection(0);
}
}
update();
